<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/popup.css">
  <link rel="stylesheet" href="/css/sign-up-email.css">
  <style>

  </style>
</head>
<body>
  <!-- Header -->
<!--  <header>-->
<!--    <div th:replace="/fragments/layout.html::#header"></div>-->
<!--    <div th:replace="/fragments/layout.html::#userNav-after"></div>-->
<!--  </header>-->

  <!-- Map -->
  <input type = "button" value = "현재 위치" onclick = "getLocation()">
  <div id="map" style="width:500px;height:400px;"></div>


  <script src="https://code.jquery.com/jquery-3.6.1.slim.js"
          integrity="sha256-tXm+sa1uzsbFnbXt8GJqsgi2Tw+m4BLGDof6eUPjbtk="
          crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
  <script src="/js/common.js"></script>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ad04586737d6fd7bff8b052c6571e5a3&libraries=drawing"></script>
  <script>

    let lat = 33.450701;
    let lon = 126.570667;

    // <<<< 카카오 지도 >>>>
    // ==== 카카오 지도 뷰 ====
    var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
    var options = { //지도를 생성할 때 필요한 기본 옵션
      center: new kakao.maps.LatLng(lat, lon), //지도의 중심좌표.
      level: 3 //지도의 레벨(확대, 축소 정도)
    };

    var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

    // ==== 현재 위치 마커 ====
    var markerPosition  = new kakao.maps.LatLng(lat, lon); // 마커가 표시될 위치입니다

    var marker = new kakao.maps.Marker({  // 마커를 생성합니다
      position: markerPosition
    });

    marker.setMap(map); // 마커가 지도 위에 표시되도록 설정합니다

    // ==== 병원 위치 마커 ====
    var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png";

    var positions = new Array();

    for (var i = 0; i < positions.length; i ++) {

      // 마커 이미지의 이미지 크기 입니다
      var imageSize = new kakao.maps.Size(24, 35);

      // 마커 이미지를 생성합니다
      var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize);

      // 마커를 생성합니다
      var marker = new kakao.maps.Marker({
        map: map, // 마커를 표시할 지도
        position: positions[i].latlng, // 마커를 표시할 위치
        title : positions[i].title, // 마커의 타이틀, 마커에 마우스를 올리면 타이틀이 표시됩니다
        image : markerImage // 마커 이미지
      });
    }

    // <<<< 현재 위치 찾기 >>>>
    function getLocation() {
      if (navigator.geolocation) { // GPS를 지원하면
        navigator.geolocation.getCurrentPosition(

            // 성공시 latitude, longitude 정보 사용 가능
            function(position) {
              lat = position.coords.latitude;
              lon = position.coords.longitude;

              // === 현재 위치 변경 ===
              options = { //지도를 생성할 때 필요한 기본 옵션
                center: new kakao.maps.LatLng(lat, lon), //지도의 중심좌표.
                level: 3 //지도의 레벨(확대, 축소 정도)
              };

              map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

              // === 현재 위치 마커 표시 ===
              markerPosition  = new kakao.maps.LatLng(lat, lon); // 마커가 표시될 위치입니다

              marker = new kakao.maps.Marker({  // 마커를 생성합니다
                position: markerPosition
              });

              marker.setMap(map); // 마커가 지도 위에 표시되도록 설정합니다

              // === 공공api에서 데이터 가져오기 ===
              getHospitalApiDate();

            },

            // 에러시 콜백 함수
            function(error) {
              console.error(error);
            },

            // 옵션
            {
              enableHighAccuracy: false, // 배터리 더 소모하여 정확한 위치 찾기
              maximumAge: 0,             // 한 번 찾은 위치 정보를 해당 초만큼 캐싱
              timeout: Infinity          // 주어진 초 안에 찾지 못하면 에러 발생
            }
        );
      } else {
        alert('GPS를 지원하지 않습니다');
      }
    }

    function getHospitalApiDate(){
      // 공공 api에서 데이터 가져오기
      let   pageIndex = 1;
      const url = '/map/hospital/' + pageIndex;
      const config = {
        headers:{
          "Content-Type":"application/json"
        }
      }

      var position = (
          {
            title: '카카오',
            latlng: new kakao.maps.LatLng(33.450705, 126.570677)
          }
      );
    }
  </script>
</body>
</html>